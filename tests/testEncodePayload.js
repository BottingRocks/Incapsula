
const Payload = require("../incapsula/payload/payload.js");


const payloadData = {
  "user_agent" : "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.141 Safari/537.36",
  "navigator_language" : "en-US",
  "navigator_languages" : {
    "languages_is_not_undefined" : false
  },
  "window_size" : {
    "window_screen_width" : 1920,
    "window_screen_height" : 1080,
    "window_screen_avail_height" : 1053,
    "window_screen_avail_left" : 0,
    "window_screen_avail_top" : 27,
    "window_screen_avail_width" : 1920,
    "window_screen_pixel_depth" : 24,
    "window_inner_width" : 1920,
    "window_inner_height" : 150,
    "window_outer_width" : 1920,
    "window_outer_height" : 1025,
    "window_device_pixel_ratio" : 1,
    "window_screen_orientation_type" : "landscape-primary",
    "window_screenX" : 0,
    "window_screenY" : 55
  },
  "date_get_time_zone_off_set" : -7,
  "has_indexed_db" : true,
  "has_body_add_behaviour" : true,
  "open_database" : true,
  "cpu_class" : "unknown",
  "platform" : "Linux x86_64",
  "do_not_track" : "unknown",
  "plugins_or_active_x_object" : "Chrome PDF Plugin::Portable Document Format::application/x-google-chrome-pdf~pdf;Chrome PDF Viewer::::application/pdf~pdf;Native Client::::application/x-nacl~,application/x-pnacl~",
  "plugins_named_item_item_refresh" : {
    "named_item" : "namedItem",
    "item" : "item",
    "refresh" : "refresh"
  },
  "canvas_hash" : {
    "is_point_in_path" : true,
    "to_data_url_image" : true,
    "screen_is_global_composite_operation" : true,
    "hash" : "68155eee8e41dafe816dfeeac85222c461f54a92"
  },
  "webgl" : {
    "get_supported_extensions" : "ANGLE_instanced_arrays;EXT_blend_minmax;EXT_color_buffer_half_float;EXT_disjoint_timer_query;EXT_float_blend;EXT_frag_depth;EXT_shader_texture_lod;EXT_texture_compression_bptc;EXT_texture_compression_rgtc;EXT_texture_filter_anisotropic;WEBKIT_EXT_texture_filter_anisotropic;EXT_sRGB;KHR_parallel_shader_compile;OES_element_index_uint;OES_fbo_render_mipmap;OES_standard_derivatives;OES_texture_float;OES_texture_float_linear;OES_texture_half_float;OES_texture_half_float_linear;OES_vertex_array_object;WEBGL_color_buffer_float;WEBGL_compressed_texture_etc1;WEBGL_compressed_texture_s3tc;WEBKIT_WEBGL_compressed_texture_s3tc;WEBGL_compressed_texture_s3tc_srgb;WEBGL_debug_renderer_info;WEBGL_debug_shaders;WEBGL_depth_texture;WEBKIT_WEBGL_depth_texture;WEBGL_draw_buffers;WEBGL_lose_context;WEBKIT_WEBGL_lose_context;WEBGL_multi_draw",
    "canvas_hash" : "f48d3195d5febc7340ab3240fce958f83d086a30",
    "canvas_hash_error" : "some can as hash error",
    "aliased_line_width_range" : [1, 7.375],
    "aliased_point_size_range" : [1, 255],
    "alpha_bits" : 8,
    "antialias" : true,
    "blue_bits" : 8,
    "green_bits" : 8,
    "depth_bits" : 24,
    "all_bits" : 16,
    "max_combined_texture_image_units" : 64,
    "max_cube_map_texture_size" : 16384,
    "max_fragment_uniform_vectors" : 1024,
    "max_renderbuffer_size" : 16384,
    "max_texture_image_units" : 32,
    "max_texture_size" : 16,
    "max_varying_vectors" : 32,
    "max_vertex_attribs" : 16,
    "max_vertex_texture_image_units" : 32,
    "max_vertex_uniform_vectors" : 1024,
    "max_viewport_dims" : [32768, 32768],
    "red_bits" : 8,
    "renderer" : "WebKit WebGL",
    "shading_language_version" : "WebGL GLSL ES 1.0 (OpenGL ES GLSL ES 1.0 Chromium)",
    "stencil_bits" : 0,
    "vendor" : "WebKit",
    "version" : "WebGL 1.0 (OpenGL ES 2.0 Chromium)",
    "shader_precision_vertex_low_float" : 23,
    "shader_precision_vertex_low_float_min" : 127,
    "shader_precision_vertex_low_float_max" : 127,
    "shader_precision_vertex_medium_float" : 23,
    "shader_precision_vertex_medium_float_min" : 127,
    "shader_precision_vertex_medium_float_max" : 127,
    "shader_precision_vertex_high_float" : 23,
    "shader_precision_vertex_high_float_min" : 127,
    "shader_precision_vertex_high_float_max" : 127,
    "shader_precision_vertex_low_int" : 0,
    "shader_precision_vertex_low_int_min" : 31,
    "shader_precision_vertex_low_int_max" : 30,
    "shader_precision_vertex_medium_int" : 0,
    "shader_precision_vertex_medium_int_min" : 31,
    "shader_precision_vertex_medium_int_max" : 30,
    "shader_precision_vertex_high_int" : 0,
    "shader_precision_vertex_high_int_min" : 31,
    "shader_precision_vertex_high_int_max" : 30,
    "shader_precision_fragment_low_float" : 23,
    "shader_precision_fragment_low_float_min" : 127,
    "shader_precision_fragment_low_float_max" : 127,
    "shader_precision_fragment_medium_float" : 23,
    "shader_precision_fragment_medium_float_min" : 127,
    "shader_precision_fragment_medium_float_max" : 127,
    "shader_precision_fragment_high_float" : 23,
    "shader_precision_fragment_high_float_min" : 127,
    "shader_precision_fragment_high_float_max" : 127,
    "shader_precision_fragment_low_int" : 0,
    "shader_precision_fragment_low_int_min" : 31,
    "shader_precision_fragment_low_int_max" : 30,
    "shader_precision_fragment_medium_int" : 0,
    "shader_precision_fragment_medium_int_min" : 31,
    "shader_precision_fragment_medium_int_max" : 30,
    "shader_precision_fragment_high_int" : 0,
    "shader_precision_fragment_high_int_min" : 31,
    "shader_precision_fragment_high_int_max" : 30,
    "unmasked_vendor_webgl" : "Google Inc.",
    "unmasked_renderer_webgl" : "ANGLE (Intel Open Source Technology Center, Mesa DRI Intel(R) HD Graphics 4600 (HSW GT2), OpenGL 4.5 core)"
  },
  "webgl_meta" : {
    "webgl_rendering_context_get_parameter" : "getParameter",
    "is_native_webgl_rendering_context_get_parameter" : true
  },
  "touch_event" : {
    "max_touch_points" : 0,
    "has_touch_event" : false,
    "on_touch_start_is_undefined" : false,
  },
  "video" : {
    "can_play_type_video_ogg" : "probably",
    "can_play_type_video_mp4" : "probably",
    "can_play_type_video_webm" : "probably",
  },
  "audio" : {
    "can_play_type_audio_ogg" : "probably",
    "can_play_type_audio_mpeg" : "probably",
    "can_play_type_audio_wav" : "probably",
    "can_play_type_audio_xm4a" : "probably",
  },
  "navigator_vendor" : "Google Inc.",
  "navigator_product" : "Gecko",
  "navigator_product_sub" : "20030107",
  "browser" : {
    "is_internet_explorer" : false,
    "is_native_load_times" : { load_times_native : true},
    "webdriver" : false,
    "is_chrome_browser" : true,
    "connection_rtt" : 0
  },
  "document" : {
    "document_location_protocol" : "https:",
  },
  "canvas_fonts" : ["PMingLiU"],
  "document_children" : {
    "document_script_element_children" : [
      {
        "src": "https://bam-cell.nr-data.net/1/24d93c7748?a=14700416&v=1210.e2a3f80&to=cwwIRUdXWlgEQU0WQ1URFR5GXUVHCFwMEB9eBhE%3D&rst=1860&ck=1&ref=https://api.id.me/en/session/new&qt=1&ap=72&be=347&fe=1757&dc=868&af=err,xhr,stn,ins,spa&perf=%7B%22timing%22:%7B%22of%22:1633729245317,%22n%22:0,%22u%22:198,%22ue%22:199,%22f%22:4,%22dn%22:4,%22dne%22:4,%22c%22:4,%22ce%22:4,%22rq%22:14,%22rp%22:189,%22rpe%22:191,%22dl%22:201,%22di%22:866,%22ds%22:867,%22de%22:872,%22dc%22:1756,%22l%22:1756,%22le%22:1759%7D,%22navigation%22:%7B%7D%7D&fp=578&fcp=578&jsonp=NREUM.setToken"
      },
      {
        "src": "https://js-agent.newrelic.com/nr-spa-1210.min.js"
      },
      {
        "src": "https://wait.id.me/javascriptqueue/idme/prodapi/1633729246269?t=https%3A%2F%2Fapi.id.me%2Fen%2Fsession%2Fnew&ver=js2.0.27"
      },
      {
        "src": "https://static.zdassets.com/ekr/asset_composer.js?key=22fb9205-0748-40d7-8eb1-c964afe88d06"
      },
      {
        "src": "https://www.google-analytics.com/analytics.js"
      },
      {
        "src": ""
      }
    ],
    "document_head_element_children" : [
      {
        "src": "https://api.id.me/I-indnes-must-to-thing-mee-see-And-thith-the-gre"
      },
      {
        "src": ""
      },
      {
        "src": ""
      },
      {
        "src": ""
      },
      {
        "src": ""
      },
      {
        "src": ""
      },
      {
        "src": "https://api.id.me/assets/analytics/device-2854bc02623bf14ff2e80dd02913907f92b5c8c4cc14944c4a805106be38c8f5.js"
      },
      {
        "src": "https://api.id.me/assets/analytics/google-da6f72148bad4c4037e015bf01d84c2245169c1146b55e69b4200b9862f1e424.js"
      },
      {
        "src": "https://static.queue-it.net/script/queueclient.min.js"
      },
      {
        "src": "https://static.queue-it.net/script/queueconfigloader.min.js"
      }
    ]
  },
  "window" : {
    "history_length" : 3,
    "navigator_hardware_concurrency" : 8,
    "is_window_self_not_window_top" : false,
    "is_native_navigator_get_battery" : true,
    "console_debug_name" : "debug",
    "is_native_console_debug" : true,
    "_phantom" : false,
    "call_phantom" : false,
    "empty" : [],
  },
  "webgl_rendering_call" : {
    "webgl_rendering_context_prototype_get_parameter_call_a" : false,
    "webgl_rendering_context_prototype_get_parameter_call_b" : false
  },
  "window_object_get_own_property_names" : "SVGComponentTransferFunctionElement;;;SVGAnimatedPreserveAspectRatio;;;RTCPeerConnectionIceErrorEvent;;;MediaStreamAudioDestinationNode;;;USBIsochronousInTransferPacket;;;USBIsochronousInTransferResult;;;USBIsochronousOutTransferPacket;;;USBIsochronousOutTransferResult;;;PresentationConnectionAvailableEvent;;;PresentationConnectionCloseEvent;;;AuthenticatorAssertionResponse;;;AuthenticatorAttestationResponse;;;OffscreenCanvasRenderingContext2D;;;webkitResolveLocalFileSystemURL;;;module$exports$mapsapi$util$event;;;module$contents$mapsapi$overlay$overlayView_OverlayView",
  "visual_view_port" : {
    "visual_view_port_width" : 1905,
    "visual_view_port_height" : 150,
    "visual_view_port_scale" : 1
  }
};

const file = process.argv.slice(-2)[0];
const xor = process.argv.slice(-1)[0];
//Load payload AST, true if it needs deobfuscation
const payload = Payload.fromFile(file);

const encodedPayload = payload.encodePayload(payloadData, xor);

console.log(`encoded payload`, encodedPayload);
